# VirtualBox 네트워크

## 개요 

VirtualBox에는 대표적으로 5가지 네트워크 설정(?)을 제공한다.

|                  | 게스트->호스트 | 게스트<-호스트 | 게스트1<->게스트2 | 게스트->인터넷 | 게스트<-인터넷 | 
| ---              | ---           | ---           | ---              | ---          | ---           |
| 내부 네트워크     |   X   |   X   |   O   |   X   |   X   |
| NAT              |    X   |   포트 포워딩 | X | O | 포트 포워딩|
| NAT 네트워크      | X | 포트 포워딩 | O | O | 포트 포워딩 |
| 호스트 전용 어댑터 | O | O | O | X | X |
| 브릿지 네트워크    | O | O | O | O | O |

### [1] 내부 네트워크

#### 개요

VirtualBox는 게스트 내에 네트워크 인터페이스를 생성한다.
여러대의 게스트를 사용할 경우 동일한 인터페이스를 공유하여 스위치처럼 사용도 가능하다.

#### 장점

- 게스트 <-> 게스트 통신이 가능하다.
- 외부 호스트에서 접근이 불가능 하기 때문에 안전하다.
- VirtualBox 가상 호스트 네트워크 인터페이스(장치 + 드라이버)가 필요 없다.

#### 단점

- 호스트 <-> 게스트 통신 불가능하다.
- 게스트 -> 인터넷 통신 불가능하다.
- VirtualBox 내부 DHCP 서버는 CLI로만 설정이 가능하다. ( GUI 불가능 )

### 이미지

![내부 네트워크 이미지](./img/03_네트워크/01_내부네트워크.png)

### [2] NAT

#### 개요

VirtualBox는 게스트의 내부 네트워크 인터페이스에 독립된 NAT 라우터를 생성한다.
게스트들은 각각 가상 라우터를 가지고 있으며 게스트간에는 통신이 불가능하다.
NAT 라우터는 VirtualBox 가상 호스트 네트워크 인터페이스를 만들 필요 없이 호스트 네트워크 인터페이스를 사용한다.
NAT 라우터는 호스트 인터페이스 쪽으로 포트를 개방할 수 있다.()

#### 장점

- 설정할 것이 거의 없어 사용하기 쉽다.
- 게스트들은 각각 자기 자신의 라우터를 가지므로 네트워크 환경이 독립되어 있다.
- VirtualBox 가상 호스트 네트워크 인터페이스가 필요없다.
- 호스트의 인터페이스를 사용하므로 인터넷에 접근 가능하다.
- 고정 IP 사용이 가능하다.

#### 단점

- 게스트 <-> 게스트, 게스트 -> 호스트 통신이 불가능 하다.
- 호스트 -> 게스트 통신을 위해서는 포트포워딩이 필요하다.
- 가상 NAT 라우터는 CLI로만 설정이 가능하다. ( GUI 불가능 )

### 이미지

![NAT 이미지](./img/03_네트워크/02_NAT.png)

### [3] NAT 네트워크

#### 개요

VirtualBox는 게스트 네트워크 인터페이스에 모든 게스트들이 사용 가능한 가상의 NAT 라우터를 제공한다. 
이를 사용하여 각각의 게스트들은 통신이 가능하다.
인터페이스의 DHCP 요청에 대한 응답은 게스트의 IP와 NAT 라우터 주소가 게이트웨이가 된다.
DHCP 서버는 CLI를 통해 설정이 가능하다. NAT 라우터는 호스트 네트워크 인터페이스를 사용한다. 그렇기 때문에 VirtualBox 네트워크 인터페이스를 따로 만들 필요 없으며 외부의 요소들은 오직 하나의 호스트 인터페이스만을 바라본다.
NAT 라우터는 호스트 인터페이스 쪽으로 포트를 개방할 수 있다.

#### 장점

- 게스트 <-> 게스트 통신이 가능하다.
- 게스트 -> 인터넷 통신이 가능하다.
- 고정 IP 사용이 가능하다.
- DHCP 서버를 GUI로 설정이 가능하다.
- VirtualBox 가상 호스트 네트워크 인터페이스가 필요없다.

#### 단점

- 호스트 -> 게스트 통신을 위해서는 포트포워딩이 필요하다.
- 사용을 위해 VirtualBox 네트워크 및 DHCP 설정이 필요하다.

### 이미지

![NAT 네트워크 이미지](./img/03_네트워크/03_NAT네트워크.png)

### [4] 호스트 전용(Host Only)

#### 개요

VirtualBox는 호스트 인터페이스를 생성한다. 이 인터페이는 게스트간에 공유될 수 있기 있기 때문에 서로 통신이 가능하다. 인터페이스에 대한 DHCP 요청에 대한 응답은 게스트의 IP 및 호스트 전용 어댑터의 주소가 된다.
DHCP 서버는 GUI를 통해 설정이 가능하며 가상 호스트 인터페이스는 호스트 밖에서 보이지 않는다.
게스트는 가상 호스트 인터페이스를 통해 인터넷에 접근할 수 없으며, 호스트는 포트포워딩을 하지 않고 게스트와 통신이 가능하다.

#### 장점

- 게스트 <-> 게스트 통신이 가능하다.
- 고정 IP 사용이 가능하다.
- DHCP 서버는 GUI를 통해 설정이 가능하다.
- 분리된 게스트 네트워크 구축이 가능하다.

#### 단점

- 게스트 -> 인터넷 통신이 불가능하다.
- 사용을 위해 VirtualBox 네트워크 및 DHCP 설정이 필요하다.

### 이미지

![호스트 전용 이미지](./img/03_네트워크/04_호스트전용.png)

### [5] 브릿지 네트워크

#### 개요

게스트에서 호스트의 인터페이스를 사용한다.
호스트 인터페이스에서 Net필터 드라이버가 적용되어 VirtualBox가 게스트에 데이터를 보낼 수 있다.
이를 위해서는 어댑터에 의해 사용되는 `무차별 모드(promiscous mode)`가 필요하다. (무차별 모드는 어댑터가 여러 MAC 주소를 가질 수 있음을 의미한다.)
대부분의 무선 어댑터는 이 기능을 지원하지 않는데 이러한 경우에는 VirtualBox는 어댑터에서 볼 수 있는 패키지의 MAC 주소를 대체한다.
외부의 DHCP서버가 

#### 장점

- 게스트 <-> 게스트 통신이 가능하다.
- 게스트 <-> 호스트 통신이 가능하다. 
- 호스트와 동일한 인터넷 접근 권한이 있다.
- 가상의 DHCP 서버가 필요 없다.
- 설정 및 사용이 간단하다.

#### 단점

- 게스트는 분리된 네트워크를 가질 수 없다.
- 사내 네트워크 환경에서 인터페이스를 차단하는 경우, 외부 DHCP 서버 및 호스트 네트워크 인터페이스 패킷을 필터링 하여 동작하지 않을 수 있다. (네트워크 환경에 따라 제공여부)
- 호스트 네트워크 환경에 따라서 고정 IP를 설정하기 쉽지 않다. (호스트 환경에 따라서 변화)
- 게스트가 호스트 네트워크 환경을 사용하므로 격리성이 보장되지 않는다. (안전성 보장x)

### 이미지

![브릿지 네트워크 이미지](./img/03_네트워크/05_브릿지(wireless).png)